#Node.js에서 프로세스 메모리 관리 방식

Node.js에서 프로세스 메모리 관리는 V8 자바스크립트 엔진의 가비지 컬렉션과 힙 메모리 관리 기법을 기반으로 이루어진다. 메모리 사용을 최적화하고 메모리 누수를 방지하기 위해 다양한 도구와 기법을 사용할 수 있으며, 객체 재사용, 클로저 사용 주의, 정기적인 메모리 릴리스 등의 최적화 기법을 통해 효율적인 메모리 관리를 할 수 있다.

---

### 1. 메모리 구조

Node.js 프로세스 메모리는 크게 다음과 같은 영역으로 나뉜다:

1. **코드 영역 (Code Segment)**:
  - 실행 파일의 코드가 저장되는 영역
2. **데이터 영역 (Data Segment)**:
  - 초기화된 전역 변수와 정적 변수가 저장되는 영역
3. **힙 영역 (Heap Segment)**:
  - 동적 메모리 할당이 이루어지는 영역
  - V8 엔진의 가비지 컬렉터(Garbage Collector)가 메모리 관리를 담당
4. **스택 영역 (Stack Segment)**:
  - 함수 호출 시 매개 변수와 지역 변수가 저장되는 영역

### 2. V8 엔진의 메모리 관리

Node.js의 메모리 관리는 주로 V8 자바스크립트 엔진에 의해 이루어진다. V8 엔진은 다음과 같은 메모리 관리 기법을 사용한다:

1. **가비지 컬렉션 (Garbage Collection)**:
  - V8 엔진은 주기적으로 가비지 컬렉션을 수행하여 더 이상 사용되지 않는 객체를 메모리에서 해제한다
  - 주요 가비지 컬렉션 알고리즘:
      - **마이너 가비지 컬렉션 (Minor GC)**: 작은 힙 영역인 새로운 공간(New Space)에서 수행
      - **메이저 가비지 컬렉션 (Major GC)**: 큰 힙 영역인 오래된 공간(Old Space)에서 수행.
2. **힙 메모리 제한**:
  - Node.js는 힙 메모리에 대한 기본 제한이 있다. 이 제한은 `-max-old-space-size`와 `-max-semi-space-size` 플래그를 사용하여 조정할 수 있다.
  - 기본적으로 64비트 시스템에서는 약 1.5GB, 32비트 시스템에서는 약 512MB로 설정되어 있다.

### 3. 메모리 프로파일링과 디버깅

Node.js 애플리케이션의 메모리 사용을 프로파일링하고 디버깅하기 위해 다음과 같은 도구와 기법을 사용할 수 있다:

1. **프로세스 메모리 사용 조회**:
  - Node.js의 `process.memoryUsage()` 메서드를 사용하여 현재 프로세스의 메모리 사용량을 확인할 수 있다.
  - 반환되는 정보:
      - `rss` (Resident Set Size): 프로세스가 사용하는 전체 메모리
      - `heapTotal`: V8 힙의 총 메모리 할당량
      - `heapUsed`: V8 힙에서 실제로 사용 중인 메모리
      - `external`: V8 외부에서 사용 중인 메모리
2. **Heap Snapshot**:
  - `-inspect` 플래그를 사용하여 Node.js 애플리케이션을 디버깅 모드로 실행하고, Chrome DevTools를 사용하여 힙 스냅샷을 찍을 수 있다.
  - 힙 스냅샷을 통해 객체 그래프와 메모리 사용을 시각적으로 분석할 수 있다.
3. **메모리 누수 디버깅**:
  - `node --inspect`와 같은 디버깅 플래그를 사용하여 애플리케이션을 실행한 후, Chrome DevTools 또는 VSCode와 같은 디버깅 도구를 통해 메모리 누수를 찾아낼 수 있다.
  - `node-memwatch`와 같은 라이브러리를 사용하여 메모리 누수를 감지하고 분석할 수 있다.