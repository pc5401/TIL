# Chrome 브라우저의 prerendering & prefetching

## 발견한 현상
로컬에서 웹 개발 테스트를 하던 중, 크롬 브라우저에서 주소창에 `l`만 입력했을 때도 서버에서 통신이 발생하는 것을 발견했다. 아직 `localhost:3000`을 검색하지 않았지만, 크롬은 추천 검색으로 이를 제시하며 이미 서버와의 통신이 일어나고 있었다.  

## 원인 분석
- 이는 브라우저가 사용자의 행동을 미리 예측하고, 웹 페이지에 접근하기 전에 네트워크 요청을 미리 처리하는 최적화 기능이다.
- 정확히는 브라우저는 **프리페칭(prefetching)**과 **프리렌더링(prerendering)**이라는 성능 최적화 기능을 통해 사용자의 검색이나 웹 탐색을 가속화하려는 목적을 가지고 있다. 
  - **프리페칭(prefetching)**: 사용자가 특정 URL을 방문할 가능성이 높다고 판단될 때, 브라우저가 해당 페이지의 일부 또는 전체 리소스를 미리 다운로드하여 캐싱한다. 이를 통해 사용자가 실제로 그 URL을 방문할 경우 페이지 로딩 속도를 크게 줄일 수 있다.
  - **프리렌더링(prerendering)**: 프리페칭의 한 단계 발전된 형태로, 단순히 리소스를 미리 다운로드하는 것에서 더 나아가 페이지를 미리 렌더링하여 백그라운드에서 로딩이 완료된 상태로 대기시킨다. 사용자가 페이지에 접속하면 즉시 보여질 수 있도록 준비된다.
- 주로 자동 완성(autocomplete)이나 사용자가 자주 방문한 페이지에 대해 사용된다. 
- 사용자가 주소창에 URL을 입력하는 도중에도 미리 통신이 발생할 수 있는 이유는 바로 이러한 브라우저의 **선제적 리소스 로딩** 때문이다.

## 관련 메커니즘
1. **DNS Prefetching**: 브라우저는 페이지 로딩을 빠르게 하기 위해, 해당 페이지에 연결된 다른 리소스들에 대해 미리 DNS 조회를 할 수 있다. 이를 통해 리소스 요청에 걸리는 지연 시간을 줄일 수 있다.
2. **Link Rel Prefetching**: HTML 문서에서 `<link rel="prefetch">` 태그를 사용하여 특정 리소스를 미리 불러오도록 할 수 있다. 이는 브라우저에게 특정 리소스를 사용자가 필요로 할 가능성이 높다는 신호를 보내, 해당 리소스를 백그라운드에서 미리 다운로드하도록 한다.
3. **Prerendering**: `<link rel="prerender">` 태그를 통해 전체 페이지를 미리 렌더링할 수 있다. 사용자가 페이지에 도착할 때 로딩 없이 즉시 콘텐츠를 볼 수 있게 된다.

## 성능 최적화 vs. 리소스 낭비
이러한 최적화 기능은 대부분의 경우 사용자 경험을 개선하지만, 잘못 구성되면 불필요한 리소스 낭비로 이어질 수 있다. 예를 들어, 사용자가 실제로 방문하지 않을 URL에 대해 프리페치 요청이 발생하면 네트워크 트래픽이 낭비될 수 있다. 또한 서버의 입장에서는 미리 보내는 요청으로 인해 불필요한 부하가 걸릴 수 있다.

## 해결 방법
만약 이러한 기능을 원치 않거나, 특정 상황에서 비활성화해야 한다면 크롬 브라우저의 설정을 통해 이를 관리할 수 있다.

1. **프리페칭 비활성화 방법**:
   - 크롬 설정 > 개인정보 및 보안 > 쿠키 및 기타 사이트 데이터 > 페이지를 더 빠르게 로드하기 위해 네트워크 동작을 예측하여 리소스를 미리 로드 설정을 해제하면 프리페치 기능을 비활성화할 수 있다.

2. **프리렌더링 비활성화 방법**:
   - 직접 설정으로 비활성화하기 어렵기 때문에 웹 개발자는 `<link rel="prerender">` 태그의 사용을 주의해야 하며, 불필요한 경우 이 태그를 사용하지 않아야 한다.

## 추가 고려사항
프리페칭과 프리렌더링 기능은 개발자가 성능 최적화를 위해 의도적으로 사용할 수도 있지만, 의도치 않은 네트워크 부하나 리소스 낭비를 막기 위해 세심한 계획이 필요하다. 
- 예)
   - **불필요한 페이지에 대해 프리페치 요청이 가지 않도록** 주의, 사용자 경험을 고려한 리소스 미리 로드가 필요하다.
   - 서버에서도 프리페치 요청을 구분하여 불필요한 부하를 줄일 수 있도록 처리하는 방법을 고려


## 참고
- 크롬의 최적화 기능은 페이지 로딩 속도 개선과 사용자 경험 향상을 위한 것이며, 필요에 따라 비활성화가 가능하다.
